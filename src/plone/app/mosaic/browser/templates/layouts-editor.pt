<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      lang="en"
      metal:use-macro="context/prefs_main_template/macros/master"
      xml:lang="en"
      i18n:domain="plone"
>

  <metal:block fill-slot="top_slot">
    <metal:override define-slot="top_slot">
      <tal:defines tal:define="
                     dummy python:request.set('disable_toolbar',1);
                     disable_column_one python:request.set('disable_plone.leftcolumn', 1);
                     disable_column_two python:request.set('disable_plone.rightcolumn', 1);
                   " />
    </metal:override>
  </metal:block>

  <body>


    <metal:main metal:fill-slot="prefs_configlet_main"
                i18n:domain="plone"
    >

      <a id="setup-link"
         href=""
         tal:attributes="
           href string:$portal_url/@@overview-controlpanel;
         "
         i18n:translate=""
      >
       Site Setup
      </a>
      <h1 class="documentFirstHeading"
          i18n:translate=""
      >Layouts Editor</h1>

      <p class="documentDescription"
         i18n:translate=""
      >
      Edit content layouts
      </p>

      <div id="content-core"
           tal:define="icons nocall:context/@@iconresolver;
                       authToken context/@@authenticator/token;
                       action request/action|nothing">
        <div id="mosaic-show-hide-layouts" class="table-responsive" tal:condition="python:action != 'edit'">
          <table class="table table-sm table-bordered">
            <thead>
              <tr>
                <th>Title</th>
                <th>Path</th>
                <th>Types</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr tal:repeat="layout view/list_contentlayouts">
                <td>${layout/title}</td>
                <td>${layout/key}</td>
                <td>${layout/_for}</td>
                <td>
                  <a class="btn btn-sm btn-outline-secondary" tal:define="hidden layout/hidden" title="toggle visibility"
                    href="${context/absolute_url}/@@${view/__name__}?action=${python:'show' if hidden else 'hide'}&layout=${layout/key}&_authenticator=${authToken}">
                    <img tal:replace="structure python:icons.tag('eye-slash' if hidden else 'eye')" />
                  </a>
                  <a class="btn btn-sm btn-outline-secondary"
                     href="${context/absolute_url}/@@${view/__name__}?action=edit&layout=${layout/key}">
                     <img tal:replace="structure python:icons.tag('pencil')" />
                  </a>
                  <a class="btn btn-sm btn-outline-danger"
                     href="${context/absolute_url}/@@manage-layouts-from-editor?action=deletelayout&layout=${layout/key}&_authenticator=${authToken}">
                    <img tal:replace="structure python:icons.tag('trash')" />
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <form action="./@@${view/__name__}" method="POST"
              tal:condition="python:action == 'edit'"
              tal:define="layout request/layout|nothing">
          <input tal:replace="structure context/@@authenticator/authenticator" />
          <input type="hidden" name="action" value="save" />
          <input type="hidden" name="name" value="${layout}" />
          <label>Edit Layout: <i>${request/layout}</i></label>
          <textarea name="layout" class="pat-code-editor" data-pat-code-editor="language: html">${python:view.get_layout_source(layout)}</textarea>
          <div class="formControls">
            <button type="submit" class="btn btn-primary" name="form.buttons.Save">Save</button>
            <button type="submit" class="btn btn-secondary" name="form.buttons.Cancel">Cancel</button>
          </div>
        </form>
      </div>

    </metal:main>

  </body>
</html>
